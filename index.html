<!DOCTYPE html>
<html>
    <head>
        <script src="book.js">
            var newbook = new book("Name", "Author", 1997);
            console.log(newbook.getName())
        </script>

        <style>label{display: inline-block; width: 80px}</style>
    </head>
    <body>
        <label>Name</label> <input id="NameBox" type="text">
        <label>Author</label> <input id="AuthorBox" type="text">
        <label>Year Published</label> <input id="YearBox" type="text">



        

        <button id="addBookBtn" type="button"> Add new Book</button>
        <br>
        <button id="findBookBtn" type="button">Find Book</button>
        <br>
        <p id="bookFound">The book is...</p>

          

          
    </body>
    <script type="module">
            
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-analytics.js";
        import { getDatabase, ref, set, get, child, update, DataSnapshot, push } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyDomy_iTgvqoDAFqJmU1sjLditwOKFdf_o",
          authDomain: "cpsc254library.firebaseapp.com",
          projectId: "cpsc254library",
          storageBucket: "cpsc254library.appspot.com",
          messagingSenderId: "783490531388",
          appId: "1:783490531388:web:bfe47ed7a478703f52c339",
          measurementId: "G-T5TJPH6M0G",
          //databaseURL: "https://cpsc254library-default-rtdb.firebaseio.com"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase();

        
        var addBookButton = document.getElementById("addBookBtn");
        var findBookButton = document.getElementById("findBookBtn");

        var name = document.getElementById("NameBox");
        var author = document.getElementById("AuthorBox");
        var year = document.getElementById("YearBox");
        var year_children = 0;

        
        function addBook(){

            const reference = ref(database);
            get(child(reference, 'Years/')).then((snapshot)=>{
                if(snapshot.exists()){
                    year_children = snapshot.size + 1;
                    console.log(snapshot.size);
                    console.log(year_children);
                }
                else{
                    console.log("Empty")
                }
            }).catch((error)=>{
                console.error(error);
            })

            set(ref(database, 'Authors/' + author.value), {
                Books: name.value
            })

            set(ref(database, 'Years/' + year.value ), {
                1: name.value
            })

            set(ref(database, 'Books/' + name.value), {
                author: author.value,
                year: year.value
            })
            .then(()=>{
            alert('data succesfully added');
        })
        .catch((error)=>{
            alert("unsuccessful");
            console.log(error);
        })
        }

        function findBook(){
            const dbref = ref(database)
            get(child(dbref, 'Books/' + name.value)).then((snapshot)=> {
                if(snapshot.exists()){
                    console.log(snapshot.val());
                    document.getElementById("bookFound").innerHTML = "The Book is Found";
                }
                else{
                    console.log("Unavailable")
                    document.getElementById("bookFound").innerHTML = "The Book is not available";
                }
            }).catch((error) => {
                console.error(error);
            })
        }


        addBookButton.addEventListener('click', addBook);
        findBookButton.addEventListener('click', findBook);

        

      </script>
</html>